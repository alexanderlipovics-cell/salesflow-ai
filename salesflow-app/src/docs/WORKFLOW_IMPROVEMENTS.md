# ðŸ”„ Sales Flow AI - Workflow & Automatisierungen

## Ãœbersicht der Verbesserungen

Diese Aktualisierung vereinheitlicht und automatisiert den gesamten Daily Flow:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    UNIFIED DAILY FLOW SYSTEM                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚   Pending    â”‚ + â”‚  Daily Flow  â”‚ = â”‚   Unified    â”‚                â”‚
â”‚  â”‚   Actions    â”‚   â”‚   Actions    â”‚   â”‚   Actions    â”‚                â”‚
â”‚  â”‚ (Zahlungen,  â”‚   â”‚ (aus Plan)   â”‚   â”‚  (sortiert,  â”‚                â”‚
â”‚  â”‚  Follow-ups) â”‚   â”‚              â”‚   â”‚  priorisiert)â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚         â”‚                  â”‚                   â”‚                        â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                   â”‚                        â”‚
â”‚                      â–¼                         â”‚                        â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚                        â”‚
â”‚              â”‚ CHIEF Contextâ”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚              â”‚ (weiÃŸ alles) â”‚                                           â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚
â”‚                      â”‚                                                  â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚         â–¼            â–¼            â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚  â”‚ Workflow â”‚ â”‚  Finance â”‚ â”‚ Coaching â”‚                                â”‚
â”‚  â”‚ Coaching â”‚ â”‚ Warnings â”‚ â”‚  Prompts â”‚                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Neue Komponenten

### 1. Backend Services

#### `daily_flow_actions.py`
Vereinheitlicht alle Action-Quellen:
- Pending Actions (aus `lead_pending_actions`)
- Daily Flow Actions (aus `daily_flow_actions`)
- Automatische Priorisierung
- Zeit-SchÃ¤tzungen

```python
# Nutzung
service = get_daily_flow_actions_service(db)
actions = await service.get_unified_actions(user_id)
summary = await service.get_daily_summary(user_id)
```

#### `workflow_automation.py` (Cron Job)
Automatisierte Hintergrund-Prozesse:

| Job | Zeitpunkt | Funktion |
|-----|-----------|----------|
| `recurring` | 00:05 | Wiederkehrende Buchungen |
| `snooze` | StÃ¼ndlich | Gesnoozete Actions reaktivieren |
| `payments` | Alle 4h | ZahlungsprÃ¼fungs-Reminder |
| `inactive` | 00:05 | Inaktive Leads markieren |
| `daily` | 23:00 | Daily Flow vorbereiten |
| `tax` | Quartalsende | Steuer-Reserve Warnung |

### 2. API Routes

#### `/api/v1/daily-flow/unified-actions`
```json
GET /daily-flow/unified-actions?for_date=2025-12-02

Response:
[
  {
    "id": "uuid",
    "source": "pending_action",
    "action_type": "check_payment",
    "priority": 1,
    "lead_name": "Maria MÃ¼ller",
    "title": "ðŸ’° Zahlung prÃ¼fen: Maria MÃ¼ller",
    "is_urgent": true,
    "is_overdue": false
  },
  ...
]
```

#### `/api/v1/daily-flow/summary`
```json
GET /daily-flow/summary

Response:
{
  "date": "2025-12-02",
  "total_actions": 15,
  "completed_actions": 3,
  "completion_rate": 20.0,
  "payment_checks": 2,
  "follow_ups": 8,
  "overdue_count": 1,
  "urgent_count": 3,
  "estimated_time_minutes": 95
}
```

### 3. Frontend

#### `useUnifiedActions` Hook
```javascript
const {
  actions,           // Alle Actions
  urgentActions,     // Nur dringende
  paymentChecks,     // Nur Zahlungen
  summary,           // Tages-Summary
  
  complete,          // Action abschlieÃŸen
  snooze,            // Verschieben
  snoozeTomorrow,    // Auf morgen
  
  isLoading,
  refresh,
} = useUnifiedActions();
```

#### `UrgentActionsWidget`
Widget fÃ¼r Dashboard:
- Zeigt dringende Actions prominent
- Rot markiert Ã¼berfÃ¤llige
- Quick-Actions (Tap â†’ Lead Ã¶ffnen)

#### `PaymentChecksWidget`
Spezial-Widget fÃ¼r ZahlungsprÃ¼fungen:
- Anzahl offener PrÃ¼fungen
- GeschÃ¤tzte Summe
- Quick-Access zu Leads

### 4. CHIEF Integration

#### Erweiterter Context
CHIEF kennt jetzt:
- Pending Actions (Anzahl, Typen, Top 3)
- Finance Summary (Profit, Reserve, fehlende Belege)
- Workflow-Status (Ã¼berfÃ¤llig, dringend)

#### Proaktives Coaching
```
User: "Was muss ich heute machen?"

CHIEF: "Dein nÃ¤chster Move: PrÃ¼f die Zahlung von Maria â€“ sie hat 
vor 3 Tagen bestellt. ðŸ’°

Wenn bezahlt â†’ als Kunde markieren, Welcome-Nachricht senden.
Wenn nicht â†’ freundlich nachhaken.

Danach hast du noch 2 Follow-ups und 5 neue Kontakte fÃ¼r heute."
```

## Priorisierungs-Logik

```
1. ðŸ’° ZahlungsprÃ¼fungen (Geld wartet!)
   â””â”€ priority: 1
   
2. â° ÃœberfÃ¤llige Actions
   â””â”€ is_overdue: true
   
3. ðŸ”¥ HeiÃŸe Leads (deal_state)
   â””â”€ 'pending_payment' > 'negotiating' > 'interested'
   
4. ðŸ“± Follow-ups nach Alter
   â””â”€ Ã„lteste zuerst
   
5. ðŸ‘‹ Neue Kontakte
   â””â”€ Aus Daily Flow Plan
```

## Zeit-SchÃ¤tzungen

| Action Type | GeschÃ¤tzte Minuten |
|-------------|-------------------|
| check_payment | 5 |
| follow_up | 8 |
| call | 15 |
| send_info | 5 |
| new_contact | 10 |
| reactivation | 8 |
| close | 20 |

## Installation

### 1. Backend
```bash
# Neue Routen sind automatisch registriert via main.py
uvicorn backend.app.main:app --reload
```

### 2. Cronjobs
Siehe `backend/cron/CRON_SETUP.md`

### 3. Frontend
```javascript
// In App.js oder Navigation
import { useUnifiedActions } from './hooks/useUnifiedActions';
import { UrgentActionsWidget } from './components/workflow';
```

## Testing

```bash
# Backend
python -m app.jobs.workflow_automation all

# API
curl http://localhost:8000/api/v1/daily-flow/summary

# Frontend
# â†’ DailyFlowScreen Ã¶ffnen, Unified Actions sollten erscheinen
```

## NÃ¤chste Schritte

- [ ] Drag & Drop Reihenfolge fÃ¼r Actions
- [ ] Bulk-Completion (mehrere auf einmal)
- [ ] Zeitblock-Scheduling ("Focus Mode")
- [ ] Team-Ansicht fÃ¼r Leader
- [ ] Automatische Eskalation bei Ã¼berfÃ¤lligen Actions

